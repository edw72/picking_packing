<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Etiquetas PDF para #{{ orden.numero_pedido }}</title>
    <style>
        /* La directiva @page es la clave. Define el tamaño del papel. */
        @page {
            size: 4in 2in; /* Ancho x Alto de tu etiqueta */
            margin: 0.1in; /* Un pequeño margen para evitar cortar los bordes */
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            font-size: 10pt; /* Tamaño de fuente base */
        }
        .etiqueta {
            width: 3.8in; /* Ancho total menos los márgenes */
            height: 1.8in; /* Alto total menos los márgenes */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            /* Cada etiqueta empezará en una nueva página del PDF */
            page-break-before: always;
        }
        .etiqueta.primera-pagina {
            page-break-before: auto;
        }

        .etiqueta-header {
            text-align: center;
        }
        .etiqueta-header h1 {
            font-size: 11pt;
            margin: 0;
            font-weight: bold;
        }
        .etiqueta-header p {
            font-size: 9pt;
            margin: 2px 0;
        }

        .etiqueta-body {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.2in;
        }
        .etiqueta-body .qr-code {
            flex: 0 0 1.2in; /* No crece, no se encoge, base de 1.2 pulgadas */
            text-align: center;
        }
        .etiqueta-body .qr-code img {
            width: 1.2in;
            height: 1.2in;
        }
        .etiqueta-body .info {
            flex-grow: 1;
            text-align: center;
        }
        .etiqueta-body .info .tipo-bulto {
            font-size: 24pt;
            font-weight: bold;
            margin: 0;
        }
        .etiqueta-body .info .contador-bulto {
            font-size: 16pt;
            margin: 5px 0;
        }

        .etiqueta-footer {
            text-align: center;
            font-size: 9pt;
            font-weight: bold;
        }
    </style>
</head>
<body>
    {% set total_bultos = orden.bultos|length %}
    {% for bulto in orden.bultos %}
        <div class="etiqueta {{ 'primera-pagina' if loop.first }}">
            <div class="etiqueta-header">
                <h1>{{ orden.cliente_nombre }}</h1>
                <p>Pedido #{{ orden.numero_pedido }}</p>
            </div>
            <div class="etiqueta-body">
                <div class="qr-code">
                    <img src="{{ url_for('qr_code_generator', identificador_unico=bulto.identificador_unico, _external=True) }}" alt="QR">
                </div>
                <div class="info">
                    <h2 class="tipo-bulto">{{ bulto.tipo }}</h2>
                    <p class="contador-bulto">{{ loop.index }} de {{ total_bultos }}</p>
                </div>
            </div>
            <div class="etiqueta-footer">
                ID: {{ bulto.identificador_unico }}
            </div>
        </div>
    {% endfor %}
</body>
</html>